<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kudos App</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Kudos List</h1>
    <table id="kudosTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Comments</th>
                <th>Created At</th>
                <th>Sender Email</th>
                <th>Receiver Email</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <h2>Add Kudos</h2>
    <form id="addKudosForm">
        <label for="comments">Comments:</label>
        <input type="text" id="comments" name="comments" required>
        <br>
        <label for="sender_email">Sender Email:</label>
        <input type="email" id="sender_email" name="sender_email" required>
        <br>
        <label for="receiver_email">Receiver Email:</label>
        <input type="email" id="receiver_email" name="receiver_email" required>
        <br>
        <button type="submit">Add Kudos</button>
    </form>

    <script>
        const API_BASE_URL = '/data-api/rest';

        function getKudos() {
            fetch(`${API_BASE_URL}/Kudos`)
                .then(response => response.json())
                .then(data => {
                    displayKudos(data.value);
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        function displayKudos(kudosList) {
            const tableBody = document.querySelector('#kudosTable tbody');
            tableBody.innerHTML = '';

            kudosList.forEach(kudos => {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td>${kudos.idkudos}</td>
                    <td>${kudos.comments}</td>
                    <td>${kudos.created_at}</td>
                    <td>${kudos.sender_email}</td>
                    <td>${kudos.receiver_email}</td>
                    <td>
                        <button data-id="${kudos.idkudos}" class="delete-btn">Delete</button>
                    </td>
                `;

                tableBody.appendChild(row);
            });

            const deleteButtons = document.querySelectorAll('.delete-btn');
            deleteButtons.forEach(btn => {
                btn.addEventListener('click', (event) => {
                    const id = event.target.getAttribute('data-id');
                    deleteKudos(id);
                });
            });
        }

        function addKudos(kudosData) {
            fetch(`${API_BASE_URL}/Kudos`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(kudosData)
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Error adding kudos');
                }
            })
            .then(() => {
                getK
                Kudos();
            })
            .catch(error => {
                console.error('Error adding kudos:', error);
            });
        }

        function deleteKudos(id) {
            fetch(`${API_BASE_URL}/Kudos/idkudos/${id}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (response.ok) {
                    getKudos();
                } else {
                    throw new Error('Error deleting kudos');
                }
            })
            .catch(error => {
                console.error('Error deleting kudos:', error);
            });
        }

        document.querySelector('#addKudosForm').addEventListener('submit', (event) => {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const kudosData = {
                comments: formData.get('comments'),
                sender_email: formData.get('sender_email'),
                receiver_email: formData.get('receiver_email')
            };

            addKudos(kudosData);
            event.target.reset();
        });

        getKudos();
    </script>
</body>
</html>
